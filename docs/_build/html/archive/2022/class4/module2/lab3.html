<!DOCTYPE html>
<head>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPZPQ6');</script>
  <!-- End Google Tag Manager -->
    <title>Lab 3: Create TCP Load Balancer</title>
  

  <meta charset="utf-8">
  <!-- Twitter Bootstrap viewport setting -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- F5 metadata -->
  <meta name="title" content="Lab 3: Create TCP Load Balancer"/>
  <meta name="product" content="F5 Distributed Cloud"/>
  <meta name="version" content=""/>
  <meta name="updated_date"  content="2023-12-22 16:58:44"/>
  <meta name="archived" content="Archived documents excluded"/>
  <meta name="doc_type" content="Manual"/>
  <meta name="lifecycle" content="release"/>
  <meta name="F5 Distributed Cloud" content=""/>


  

  
  <link href="https://cdn.f5.com/favicon.ico" rel="icon">

</head>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lab 3: Create TCP Load Balancer &#8212; F5 Distributed Cloud  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" href="../../../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/f5.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/f5-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/CoveoFullSearch.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/21fb8a09c3.css" type="text/css" />
    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="sidebar" class="section-nav">
      
      <!--  version selector ------------------>
      <div id="version_selector_wrapper">
      </div>
      <nav class="nav-sidebartoc">

        
         <h5>F5 Distributed Cloud  </h5>
        

        <hr>
        <span class="nav-sidebartoc">
            <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../class1/class1.html">F5 Distributed Cloud - Introduction to Deployment Models and Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../class2/class2.html">F5 Distributed Cloud - WAF/WAAP Deeper Dive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../class3/class3.html">F5 Distributed Cloud - WAF/WAAP Deeper Dive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../class4/class4.html">F5 Distributed Cloud - WAF/WAAP Deeper Dive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../class5/class5.html">F5 Distributed Cloud - Advanced Bot Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../class6/class6.html">F5 Distributed Cloud - Intro to Multi-Cloud Networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../class7/class7.html">F5 Distributed Cloud - AppStack CaaS &amp; K8s Delivery Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../class8/class8.html">F5 Distributed Cloud - Introduction to Deployment Models and Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../class9/class9.html">F5 Distributed Cloud - WAF Policy Supervisor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../archive.html">Archived F5 Distributed Cloud Labs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../2hour/2hour.html">Two (2) Hour F5 Distributed Cloud Labs</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>


    <div id="right-sidebar">
      <h7 style="font-weight:normal">On this page:</h7>
      <nav class="nav-sidebartoc">
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">Lab 3: Create TCP Load Balancer</a><ul>
<li><a class="reference internal" href="#exercise-1-verify-dns">Exercise 1: Verify DNS</a></li>
<li><a class="reference internal" href="#exercise-2-origin-pool">Exercise 2: Origin Pool</a></li>
<li><a class="reference internal" href="#exercise-3-create-backend-tcp-load-balancer">Exercise 3: Create Backend TCP Load Balancer</a></li>
<li><a class="reference internal" href="#exercise-4-verify-dns-again">Exercise 4: Verify DNS Again</a></li>
<li><a class="reference internal" href="#exercise-5-connect-to-the-backend">Exercise 5: Connect to the backend</a></li>
</ul>
</li>
</ul>

         </span>
      </nav>
    </div>





  
  <div class="main active" id="content" >
    <article class="docs-container site-article-inner">
              <!-- custom breadcrumb -->
        <h5>
            <a href="../../../../index.html">F5 Distributed Cloud</a>

          <span class="right">
             <a href="../../../../_sources/archive/2022/class4/module2/lab3.rst.txt" rel="nofollow">Source</a> |
             <a href="https://github.com/f5devcentral/f5-agility-labs-xc">Edit on <i class="fa fa-github" aria-hidden="true"></i></a>
          </span>
        </h5>
        <!-- end custom breadcrumb -->
      


    <!--a title="Export PDF" id="export-pdf" class="btn btn btn-link pull-right">View PDF</a-->
    <button type="button" id="export-pdf" class="btn btn-link right">PDF</button>


    
     
         <div class="sidebar" id="version-warning" style="display: none;">
           <p class="first sidebar-title">
           <span class="icon fa fa-info-circle fa-lg"></span> Version notice:</p>
           <p class="last" id="currentVersion"></p>
          </div>


     <div role="main">
        
  <div class="section" id="lab-3-create-tcp-load-balancer">
<h1>Lab 3: Create TCP Load Balancer<a class="headerlink" href="#lab-3-create-tcp-load-balancer" title="Permalink to this heading">¶</a></h1>
<p>On of the requirements from the “Narrative” is to enable the frontend application
in AWS to communicate with the backend application that is on-prem.</p>
<p>The frontend application makes use of DNS to determine the IP address of the backend
application.  In the on-prem environment the name “adjective-animal.example.internal” resolves to
the backend IP of 10.1.20.5.</p>
<p>In the AWS environment we want to resolve the name “adjective-animal.example.internal” to resolve to
the IP address of the Distributed Cloud Mesh.  The Cloud Mesh will host a Virtual IP (VIP) that will
host a TCP Load Balancer that will proxy traffic back to the original backend application.</p>
<img alt="../../../../_images/tcplb-lab.png" src="../../../../_images/tcplb-lab.png" />
<div class="section" id="exercise-1-verify-dns">
<h2>Exercise 1: Verify DNS<a class="headerlink" href="#exercise-1-verify-dns" title="Permalink to this heading">¶</a></h2>
<p>In the previous lab exercise we made a “In Container Diagnostic Services” service available.</p>
<p>This is small application that allows you to run tools to verify DNS and run commands like “curl”
to simulate HTTP/HTTPS connections from inside the AWS environment.</p>
<ol class="arabic">
<li><p class="first">Click on DNS Lookup</p>
</li>
<li><p class="first">Enter “jumphost.lab.f5demos.internal” in the <em>target</em> field.</p>
</li>
<li><p class="first">After the “&#64;” replace the 10.0.5.xxx value with “10.0.0.2”</p>
</li>
<li><p class="first">Click on <strong>Lookup</strong></p>
<img alt="../../../../_images/dns-lookup-jumphost.png" src="../../../../_images/dns-lookup-jumphost.png" />
</li>
</ol>
<p>You’ll see that the private IP of the jumphost is returned.  The Distributed Cloud Mesh node used the
internal DNS of your AWS site to resolve the IP of the private jumphost and made use of the
secure tunnel to the Distributed Cloud Regional Edge to expose the service.</p>
<p>Next we will verify that we do not have a DNS record for adjective-animal.example.internal</p>
<ol class="arabic simple">
<li>Refresh your browser window</li>
<li>Click on DNS Lookup</li>
<li>Verify that you see “10.0.5.xxx” after the “&#64;”</li>
<li>Enter “adjective-animal.example.internal” (replace adjective-animal with your namespace ID i.e. poetic-quail)</li>
<li>Click on Lookup</li>
</ol>
<p>You should receive an error.  You should look for “SERVFAIL” that indicates the name does not exist.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">;</span> <span class="o">&lt;&lt;&gt;&gt;</span> <span class="n">DiG</span> <span class="mf">9.16.1</span><span class="o">-</span><span class="n">Ubuntu</span> <span class="o">&lt;&lt;&gt;&gt;</span> <span class="o">@</span><span class="mf">10.0.5.220</span> <span class="n">poetic</span><span class="o">-</span><span class="n">quail</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">internal</span> <span class="n">A</span>
<span class="p">;</span> <span class="p">(</span><span class="mi">1</span> <span class="n">server</span> <span class="n">found</span><span class="p">)</span>
<span class="p">;;</span> <span class="k">global</span> <span class="n">options</span><span class="p">:</span> <span class="o">+</span><span class="n">cmd</span>
<span class="p">;;</span> <span class="n">Got</span> <span class="n">answer</span><span class="p">:</span>
<span class="p">;;</span> <span class="o">-&gt;&gt;</span><span class="n">HEADER</span><span class="o">&lt;&lt;-</span> <span class="n">opcode</span><span class="p">:</span> <span class="n">QUERY</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">SERVFAIL</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="mi">22347</span>
<span class="p">;;</span> <span class="n">flags</span><span class="p">:</span> <span class="n">qr</span> <span class="n">rd</span><span class="p">;</span> <span class="n">QUERY</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ANSWER</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AUTHORITY</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ADDITIONAL</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">;;</span> <span class="n">WARNING</span><span class="p">:</span> <span class="n">recursion</span> <span class="n">requested</span> <span class="n">but</span> <span class="ow">not</span> <span class="n">available</span>

<span class="p">;;</span> <span class="n">QUESTION</span> <span class="n">SECTION</span><span class="p">:</span>
<span class="p">;</span><span class="n">student002</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">internal</span><span class="o">.</span>       <span class="n">IN</span>      <span class="n">A</span>

<span class="p">;;</span> <span class="n">Query</span> <span class="n">time</span><span class="p">:</span> <span class="mi">3</span> <span class="n">msec</span>
<span class="p">;;</span> <span class="n">SERVER</span><span class="p">:</span> <span class="mf">10.0.5.220</span><span class="c1">#53(10.0.5.220)</span>
<span class="p">;;</span> <span class="n">WHEN</span><span class="p">:</span> <span class="n">Thu</span> <span class="n">Mar</span> <span class="mi">03</span> <span class="mi">05</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">49</span> <span class="n">UTC</span> <span class="mi">2022</span>
<span class="p">;;</span> <span class="n">MSG</span> <span class="n">SIZE</span>  <span class="n">rcvd</span><span class="p">:</span> <span class="mi">45</span>
</pre></div>
</div>
</div>
<div class="section" id="exercise-2-origin-pool">
<h2>Exercise 2: Origin Pool<a class="headerlink" href="#exercise-2-origin-pool" title="Permalink to this heading">¶</a></h2>
<ol class="arabic">
<li><p class="first">Navigate the menu to go to <em>Manage</em> -&gt; <em>Load Balancer</em>, then click <em>Origin Pools</em>.</p>
<p><img alt="origin_pools_menu" src="../../../../_images/origin_pools_menu.png" /></p>
</li>
<li><p class="first">Click the <em>Add Origin Pool</em> button.</p>
<p><img alt="origin_pools_add" src="../../../../_images/origin_pools_add.png" /></p>
</li>
<li><p class="first">Enter the following variables in the “Metadata” section:</p>
</li>
</ol>
<table border="1" class="docutils align-default">
<colgroup>
<col width="67%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Origin Pool Name</td>
<td>backend</td>
</tr>
</tbody>
</table>
<ol class="arabic simple">
<li>Click on “Add Item” under Origin Servers</li>
<li>Enter the following variables:</li>
</ol>
<table border="1" class="docutils align-default">
<colgroup>
<col width="42%" />
<col width="58%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Select Type of Origin Server</td>
<td>IP address of Origin Server on given Sites</td>
</tr>
<tr class="row-even"><td>IP address</td>
<td>10.1.20.5</td>
</tr>
<tr class="row-odd"><td>Site</td>
<td>system/student-onprem</td>
</tr>
<tr class="row-even"><td>Select Network on the site</td>
<td>Inside Network</td>
</tr>
</tbody>
</table>
<p>Click on “Apply” to return to the previous screen</p>
<ol class="arabic simple">
<li>Enter “8443” for the Port.</li>
<li>Under the <em>Health Checks</em> section, click the <em>Add Item</em> button.</li>
<li>Click the <em>Health Check object</em> dropdown list. Click the <em>Add Item</em> button.</li>
<li>In the <em>Metadata</em> section, enter the following variables:</li>
</ol>
<table border="1" class="docutils align-default">
<colgroup>
<col width="67%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Name</td>
<td>tcp</td>
</tr>
<tr class="row-odd"><td>Health Check</td>
<td>TCP HealthCheck</td>
</tr>
</tbody>
</table>
<ol class="arabic simple">
<li>Add <cite>abcd1234</cite> as the <em>Send Payload</em> then click “Continue”.</li>
<li>Click the <em>Save and Exit</em> button to close the <em>Origin Pool</em> dialogue.</li>
</ol>
</div>
<div class="section" id="exercise-3-create-backend-tcp-load-balancer">
<h2>Exercise 3: Create Backend TCP Load Balancer<a class="headerlink" href="#exercise-3-create-backend-tcp-load-balancer" title="Permalink to this heading">¶</a></h2>
<ol class="arabic">
<li><p class="first">Navigate the menu to go to <em>Manage</em> -&gt; <em>Load Balancers</em>, then click <em>TCP Load Balancers</em>.</p>
<p><img alt="tcp_lb_menu" src="../../../../_images/tcp_lb_menu.png" /></p>
</li>
<li><p class="first">Click the <em>Add TCP Load Balancer</em> button.</p>
</li>
<li><p class="first">Click the <em>Add Item</em> button in the “Basic Configuration” section.</p>
</li>
<li><p class="first">Enter the following variables into the form:</p>
<table border="1" class="docutils align-default">
<colgroup>
<col width="48%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Name</td>
<td>backend</td>
</tr>
<tr class="row-odd"><td>Domain</td>
<td>adjective-animal.example.internal</td>
</tr>
<tr class="row-even"><td>Listen Port</td>
<td>443</td>
</tr>
<tr class="row-odd"><td>SNI and Default LB choice</td>
<td>SNI</td>
</tr>
<tr class="row-even"><td>Where to Advertise the VIP</td>
<td>Advertise Custom</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><em>In the table above, replace adjective-animal with your namespace ID i.e. poetic-quail.</em></p>
</div>
</li>
<li><p class="first">Configure Origin Pools</p>
<ol class="arabic simple">
<li>Under the <em>Origin Pools</em> section, click the <em>Add Item</em> link.</li>
<li>Select the <em>backend</em> pool.</li>
<li>Click the <em>Apply</em> button to close the <em>Origin Pools</em> dialogue.</li>
</ol>
</li>
<li><p class="first">Configure Advertisement</p>
<ol class="arabic">
<li><p class="first">Under <em>Advertise Custom</em> click the <em>Configure</em> link.</p>
</li>
<li><p class="first">Click on “Add Item”</p>
</li>
<li><p class="first">You will need to add a site:</p>
<table border="1" class="docutils align-default">
<colgroup>
<col width="66%" />
<col width="34%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Select Where to Advertise</td>
<td>Site</td>
</tr>
<tr class="row-odd"><td>Site Network</td>
<td>Inside Network</td>
</tr>
<tr class="row-even"><td>Site Reference</td>
<td>student-awsnet</td>
</tr>
</tbody>
</table>
<p><img alt="tcp_lb_advertise" src="../../../../_images/tcp_lb_advertise.png" /></p>
</li>
<li><p class="first">Click the <em>Apply</em> button to exit the <em>Advertise Custom</em> dialogue.</p>
</li>
<li><p class="first">Click the <em>Apply</em> button again to return to TCP Load Balancer configuration page.</p>
</li>
</ol>
<p><img alt="tcp_lb_config" src="../../../../_images/m-basic-info-tcp.png" /></p>
</li>
<li><p class="first">Click the <em>Save and Exit</em> button to exit the <em>TCP Load Balancer</em> dialogue.</p>
</li>
</ol>
</div>
<div class="section" id="exercise-4-verify-dns-again">
<h2>Exercise 4: Verify DNS Again<a class="headerlink" href="#exercise-4-verify-dns-again" title="Permalink to this heading">¶</a></h2>
<p>F5 XC Gateway provides a recursive DNS resolver. You can either point a client
directly at the gateway or forward DNS queries that you would like F5 XC to process.</p>
<p>Using the “In Container Diagnostic Services”</p>
<ol class="arabic simple">
<li>Click on DNS Lookup</li>
<li>Enter “adjective-animal.example.internal” (replace adjective-animal with your namespace ID i.e. poetic-quail)</li>
<li>Click on Lookup</li>
</ol>
<p>You should no longer get an error.</p>
<p><img alt="dns_check" src="../../../../_images/m-dns-check.png" /></p>
</div>
<div class="section" id="exercise-5-connect-to-the-backend">
<h2>Exercise 5: Connect to the backend<a class="headerlink" href="#exercise-5-connect-to-the-backend" title="Permalink to this heading">¶</a></h2>
<p>In this exercise we will emulate how a distributed application could access a resource that
resides in another remote network via the Distributed Cloud Global Network.</p>
<p>Using the “In Container Diagnostic Services”</p>
<ol class="arabic simple">
<li>Click on “Run Command”</li>
<li>Enter “curl -sk <a class="reference external" href="https://adjective-animal.example.internal">https://adjective-animal.example.internal</a>” (replace adjective-animal with your namespace ID i.e. poetic-quail)</li>
<li>Click on Run Command</li>
</ol>
<p><img alt="check_host" src="../../../../_images/m-check-host.png" /></p>
<p>You should see an output.  Now try repeating the same but using the IP address that you retrieved in Exercise 4.</p>
<ol class="arabic simple">
<li>Click on “Run Command”</li>
<li>Enter “curl -sk <a class="reference external" href="https://10.0.5.XX">https://10.0.5.XX</a>” (replace XX with the value your retrieved in Exercise 4)</li>
<li>Click on Run Command</li>
</ol>
<p><img alt="check_ip" src="../../../../_images/m-check-ip.png" /></p>
<p>You should see an error.  This is because Distributed Cloud is expecting an SNI value.  This allows you to re-use
the same IP address for multiple different services.</p>
<p>This concludes showing how we can solve Multi Cloud Networking with the use of F5 XC Load Balancer resources.</p>
<p>We can also make use of Distributed Cloud “Global Networks” to provide routed connectivity between networks (requires non-overlapping IP space).</p>
<p>If you are interested in learning more about Global Networks you can use the following Distributed Cloud simulator: <a class="reference external" href="https://simulator.f5.com/s/cloud2cloud_via_sites">https://simulator.f5.com/s/cloud2cloud_via_sites</a></p>
<p>Thank you for completing the lab!</p>
</div>
</div>


     </div>
    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../../../_static/js/index.js"></script>
  <script src="../../../../_static/js/jquery.appear.js"></script>
  <script src="../../../../_static/js/printThis.js"></script>
  <script src="../../../../_static/js/bootstrap.min.js"></script>
  <script src="../../../../_static/js/clouddocs.js"></script>
  <script src="../../../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
  </body>
</html>